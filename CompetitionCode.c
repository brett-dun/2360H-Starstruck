#pragma config(Sensor, in1,    powerExpander,  sensorAnalog)
#pragma config(Sensor, dgtl11, claw,           sensorDigitalOut)
#pragma config(Motor,  port2,           forklift1,     tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port3,           backLeftDrive, tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port4,           forklift2,     tmotorVex393_MC29, openLoop, reversed)
#pragma config(Motor,  port5,           forklift5,     tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port6,           forklift3,     tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port7,           frontRightDrive, tmotorVex393_MC29, openLoop, reversed)
#pragma config(Motor,  port8,           backRightDrive, tmotorVex393_MC29, openLoop, reversed)
#pragma config(Motor,  port9,           frontLeftDrive, tmotorVex393_MC29, openLoop)
#pragma config(Motor,  port10,          forklift4,     tmotorVex393_HBridge, openLoop, reversed)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

//Competition Control and Duration Settings
#pragma DebuggerWindows("debugStream")
#pragma competitionControl(Competition)
#pragma autonomousDuration(20)
#pragma userControlDuration(120)

#include "Vex_Competition_Includes.c"   //Main competition background code...do not modify!


//Supporting Files
#include <Recorder.c> //Records an autonomous run
#include <Playback.c> //Plays an autonomous run back
//#include <SkillsPlayback.c> //Plays a programming skills run back
//#include <SkillsRecorder.c> //Rocords a programming skills run


//Variables
int maxSpeed = 128; //the robot will start with its maximum speed
int enableClaw = 1; //the claw is ready to be used
int autoChoice = 2; //No autonomous will run


void pre_auton() {

	bStopTasksBetweenModes = true; //Set this to true

	//Clear the LCD
	clearLCDLine(0);
	clearLCDLine(1);
	bLCDBacklight = true; //Turn the LCD's bakclight on
	displayLCDCenteredString(0, "Autonomous:"); //Display "Autonomous:" on the top
	displayLCDCenteredString(1, "None"); //Display "None" on the bottom

	while(nLCDButtons != 2) {

		if(nLCDButtons == 1) { //Left button
			autoChoice--; //Decrement the choice
			if(autoChoice < 1) { //If it is less than one
				autoChoice = 4; //Set it to three
			}
			switch(autoChoice) { //Select code based on this variable
				case 1: displayLCDCenteredString(1, "Old Right"); break;
				case 2: displayLCDCenteredString(1, "None"); break;
				case 3: displayLCDCenteredString(1, "Right Cube"); break;
				case 4: displayLCDCenteredString(1, "Right Stars"); break;
			}
			delay(250);
		}

		if(nLCDButtons == 4) { //Right button
			autoChoice++; //Increment the choice
			if(autoChoice > 4) { //If it is greater than three
				autoChoice = 1; //Set it to one
			}
			switch(autoChoice) {
				case 1: displayLCDCenteredString(1, "Old Right"); break;
				case 2: displayLCDCenteredString(1, "None"); break;
				case 3: displayLCDCenteredString(1, "Right Cube"); break;
				case 4: displayLCDCenteredString(1, "Right Stars"); break;
			}
			delay(250);
		}

	}

}


task autonomous() {


	//Clear the LCD
	clearLCDLine(0);
	clearLCDLine(1);
	bLCDBacklight = true; //Turn the LCD's backlight on

	displayLCDCenteredString(0, "Running:"); //Display "Running" on top
	switch(autoChoice) {
		case 1: displayLCDCenteredString(1, "Right - Old"); left(); break;
		case 2: displayLCDCenteredString(1, "Nothing"); break;
		case 3: displayLCDCenteredString(1, "Right - Cube"); right(); break;
		case 4: displayLCDCenteredString(1, "Right - Star"); either(); break;
	}

	//Clear the LCD
	clearLCDLine(0);
	clearLCDLine(1);
	bLCDBacklight = true; //Turn the LCD's backlight on
	displayLCDCenteredString(0, "Done"); //

	//Shut all motors off
	motor[frontLeftDrive] = 0;
	motor[backLeftDrive] = 0;
	motor[frontRightDrive] = 0;
	motor[backRightDrive] = 0;

	motor[forklift1] = 0;
	motor[forklift2] = 0;
	motor[forklift3] = 0;
	motor[forklift4] = 0;
	motor[forklift5] = 0;
}


/*
	Main Controller
	---------------
		Joysticks:
			1	[None]
			2	Right Drive Control
			3	Left Drive Control
			4	[None]
		Buttons:
			5U && 5D	Claw Control
				5U -> Change Claw State
				5D ->
			6U && 6D Forklift Control
				6U -> Raise Forklift
				6D -> Lower Forklift
			7U && 7L && 7R && 7D  [None]
				7U ->
				7L && 7R ->
				7D ->
			8U && 8L && 8R && 8D Variable Drive Speed Control
				8U -> 128 maxSpeed
				8L && 8R -> 64 maxSpeed
				8D -> 32 maxSpeed
*/
task usercontrol() {

	//startTask(record); //Begin recording an autonomous or programming skills run

	clearTimer(T1); //Clear the timer

	//Clear the LCD
	clearLCDLine(0);
	clearLCDLine(1);
	bLCDBacklight = false; //Turn the LCD's backlight off
	displayLCDCenteredString(0, "2630H");
	displayLCDCenteredString(1, "BIG RED");

	while(true) { //Run for the duration of the entire driver control period

		if(vexRT[Btn8U]) { //If button 8U is pressed
			maxSpeed = 128; //Change the maximum speed to 128 (maximum value)
		} else if(vexRT[Btn8L] || vexRT[Btn8R]) { //If buttons 8L or 8R are pressed
			maxSpeed = 64; //Change the maximum speed to 64 (1/2 of the maximum value)
		} else if(vexRT[Btn8D]) {
			maxSpeed = 32; //Change the maximum speed to 32 (1/4 of the maximum value)
		}

		motor[frontLeftDrive] = vexRT[Ch3] * (maxSpeed / 128.0); //Control the left side of the drive train
		motor[backLeftDrive] = vexRT[Ch3] * (maxSpeed / 128.0); //Control the right side of the drive train
		motor[frontRightDrive] = vexRT[Ch2] * (maxSpeed / 128.0);
		motor[backRightDrive] = vexRT[Ch2] * (maxSpeed / 128.0);

		if(!vexRT[Btn6U] && !vexRT[Btn6D]) { //If neither button 6U nor button 6D are pressed
			//Shut off the forklift
			motor[forklift1] = 0;
			motor[forklift2] = 0;
			motor[forklift3] = 0;
			motor[forklift4] = 0;
			motor[forklift5] = 0;
		} if(vexRT[Btn6U]) { //If button 6U is pressed
			//Raise the forklift at maximum speed
			motor[forklift1] = 128;
			motor[forklift2] = 128;
			motor[forklift3] = 128;
			motor[forklift4] = 128;
			motor[forklift5] = 128;
		} else if(vexRT[Btn6D]) { //If button 6D is pressed
			//Lower the forklift at maximum speed
		 	motor[forklift1] = -128;
			motor[forklift2] = -128;
			motor[forklift3] = -128;
			motor[forklift4] = -128;
			motor[forklift5] = -128;
		}


		if(vexRT[Btn5U] && enableClaw) { //If button 5U is pressed and enable claw has a non-zero value
			SensorValue[claw] = !SensorValue[claw]; //
			enableClaw = 0; //Set the value of enable claw to zero
			clearTimer(T1); //Clear the timer
		}

		if(time1(T1) > 250) { //If T1 has a value greater than 250 (ms)
			enableClaw = 1; //Set the value of enable claw to one
		}

	}
}
